const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./UploadView-DVdhw0TC.js","./vendor-CtF1jJXn.js","./vendor-exceljs-B3-f5COA.js","./vendor-xlsx-BrcMyRkh.js","./vendor-datepicker-ChPokmFs.js","./vendor-datepicker-C4eX_GUS.css","./vendor-phosphor-CfEwt3VO.css","./Dashboard-A8tBGXSC.js","./vendor-charts-BHuuydho.js","./Dashboard-DUSw29Bw.css"])))=>i.map(i=>d[i]);
import{r as b,c as Q,o as ie,a as ue,b as y,d as S,e as l,f as P,t as A,u as w,g as Fe,h as Pe,i as Ie,n as I,j as ae,k as E,F as N,w as te,l as se,m as je,p as Re,q as Ne,s as Ue,v as Be,x as Te}from"./vendor-CtF1jJXn.js";import{E as Oe}from"./vendor-exceljs-B3-f5COA.js";import{r as Le,u as ze}from"./vendor-xlsx-BrcMyRkh.js";import{l as be,A as G}from"./vendor-datepicker-ChPokmFs.js";/* empty css                        */(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();const L=b([]),he=b(null),me=b(!1),xe=b("Processing..."),J=b(null),j=b(null),R=b(null),ye=b(null),we=b(null),W=b(!1),O=b(!0),Y=b(!1),q=b(!1),ds=Q(()=>{let s=L.value;return j.value&&(s=s.filter(e=>e.date>=j.value)),R.value&&(s=s.filter(e=>e.date<=R.value)),s}),H=Q(()=>L.value.length>0),ps=Q(()=>{const s={};return L.value.forEach(e=>{const t=e.user,o=e.project,n=e.date;s[t]||(s[t]={}),s[t][o]||(s[t][o]={}),s[t][o][n]||(s[t][o][n]=0),s[t][o][n]+=parseFloat(e.units)||0}),s});function oe(s,e){L.value=s,he.value=e}function U(s,e="Processing..."){me.value=s,xe.value=e}function K(s,e){j.value=s,R.value=e}function re(){L.value=[],he.value=null,j.value=null,R.value=null,J.value=null}function Z(s,e){ye.value=s,we.value=e,W.value=!!(s&&e)}function z(){Y.value=!Y.value}function Ye(){q.value=!0}function pe(){q.value=!1}function fe(){O.value=!O.value}const Se="openproject_timeentries",De=1e3;async function qe(s,e,t=null,o=null){if(!s||!e)throw new Error("Supabase URL and Key are required");let n=`${s}/rest/v1/${Se}?order=date_spent.desc&limit=${De}`;if(t&&o){n+=`&date_spent=gte.${t}-01`;const[r,c]=o.split("-"),i=new Date(parseInt(r),parseInt(c),0).getDate();n+=`&date_spent=lte.${r}-${c}-${i}`}else{const r=new Date,i=new Date(r.getFullYear(),r.getMonth()-2,1).toISOString().split("T")[0];n+=`&date_spent=gte.${i}`}const a=await fetch(n,{method:"GET",headers:{apikey:e,Authorization:`Bearer ${e}`,"Content-Type":"application/json",Prefer:"return=representation"}});if(!a.ok){const r=await a.json().catch(()=>({message:"Failed to connect to Supabase"}));throw new Error(r.message||"Failed to fetch from Supabase")}return a.json()}async function He(s,e,t=null,o=null){if(!s||!e)return 0;let n=`${s}/rest/v1/${Se}?limit=0`;if(t&&o){n+=`&date_spent=gte.${t}-01`;const[c,i]=o.split("-"),p=new Date(parseInt(c),parseInt(i),0).getDate();n+=`&date_spent=lte.${c}-${i}-${p}`}else{const c=new Date,p=new Date(c.getFullYear(),c.getMonth()-2,1).toISOString().split("T")[0];n+=`&date_spent=gte.${p}`}const a=await fetch(n,{method:"GET",headers:{apikey:e,Authorization:`Bearer ${e}`,Prefer:"count=exact"}});if(!a.ok)throw new Error("Failed to connect to Supabase");const r=a.headers.get("content-range");if(r){const c=r.split("/")[1];return parseInt(c)||0}return 0}function Ke(s){return s.map((e,t)=>({id:t,date:Ve(e.date_spent),user:e.user||"Unknown",units:parseFloat(e.hours)||0,project:e.project||"Unassigned",rawDate:e.date_spent})).filter(e=>e.date&&e.units>0)}function Ve(s){if(!s)return"";const e=new Date(s);return isNaN(e.getTime())?"":`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`}async function _e(s,e,t=null,o=null){U(!0,"Syncing with Supabase...");try{const n=await qe(s,e,t,o);if(!n||n.length===0)throw U(!1),new Error("No data found in Supabase");const a=Ke(n);if(a.length===0)throw U(!1),new Error("No valid data found after normalization");return await We(n),oe(a,"Supabase Connection"),J.value="supabase",U(!1),{success:!0,rowCount:n.length,isLimitReached:n.length>=De}}catch(n){throw U(!1),n}}async function We(s){try{const e=indexedDB.open("FileCache",4);return new Promise(t=>{e.onsuccess=function(o){const n=o.target.result;if(!n.objectStoreNames.contains("files")){t(!1);return}const a=n.transaction(["files"],"readwrite"),r=a.objectStore("files"),i={name:"SUPABASE_CACHE",data:s.map(p=>({Date:p.date_spent,User:p.user,Units:p.hours,Project:p.project,_isSupabase:!0})),timestamp:Date.now(),rowCount:s.length,isSupabase:!0};r.put(i),a.oncomplete=()=>t(!0),a.onerror=()=>t(!1)},e.onerror=()=>t(!1)})}catch(e){return console.error("Error caching Supabase data:",e),!1}}function ce(){try{const s=localStorage.getItem("supabaseConfig");if(s)return JSON.parse(s)}catch(s){console.error("Error loading Supabase config:",s)}return null}function Ge(s,e,t=null,o=null){localStorage.setItem("supabaseConfig",JSON.stringify({url:s,key:e,startDate:t,endDate:o}))}function Je(){localStorage.removeItem("supabaseConfig")}const ke="FileCache",Xe=4,_="files",ve=5,Ce=864e5,Ee=365*24*60*60*1e3;function ee(){return new Promise((s,e)=>{const t=indexedDB.open(ke,Xe);t.onupgradeneeded=o=>{const n=o.target.result;n.objectStoreNames.contains(_)&&n.deleteObjectStore(_),n.createObjectStore(_,{keyPath:"name"}).createIndex("timestamp","timestamp",{unique:!1})},t.onsuccess=()=>s(t.result),t.onerror=()=>e(t.error)})}async function fs(s,e,t=0){try{const o=await ee();return new Promise((n,a)=>{const c=o.transaction([_],"readwrite").objectStore(_),i={name:s.name,data:e,timestamp:Date.now(),rowCount:t},p=c.put(i);p.onsuccess=async()=>{await Qe(o),n(!0)},p.onerror=()=>a(p.error)})}catch(o){return console.error("Error caching file:",o),!1}}async function Qe(s){return new Promise(e=>{const n=s.transaction([_],"readwrite").objectStore(_).getAll();n.onsuccess=()=>{const a=n.result||[];if(a.length>ve){a.sort((p,f)=>p.timestamp-f.timestamp);const r=a.slice(0,a.length-ve),i=s.transaction([_],"readwrite").objectStore(_);r.forEach(p=>{p.name!=="SUPABASE_CACHE"&&i.delete(p.name)})}e()},n.onerror=()=>e()})}async function vs(){try{const s=await ee();return new Promise(e=>{const n=s.transaction([_],"readonly").objectStore(_).getAll();n.onsuccess=()=>{const a=n.result||[],r=Date.now(),c=a.filter(i=>{const p=r-i.timestamp;return i.name==="SUPABASE_CACHE"||i.isSupabase?p<Ee:p<Ce}).sort((i,p)=>p.timestamp-i.timestamp);e(c)},n.onerror=()=>e([])})}catch(s){return console.error("Error getting cached files:",s),[]}}async function Ze(s){try{const e=await ee();return new Promise(t=>{const a=e.transaction([_],"readonly").objectStore(_).get(s);a.onsuccess=()=>{const r=a.result;if(r){const c=Date.now()-r.timestamp,i=r.isSupabase||s==="SUPABASE_CACHE"?Ee:Ce;if(c<i){t(r);return}}t(null)},a.onerror=()=>t(null)})}catch(e){return console.error("Error loading cached file:",e),null}}async function et(s){try{const e=await ee();return new Promise((t,o)=>{const r=e.transaction([_],"readwrite").objectStore(_).delete(s);r.onsuccess=()=>t(!0),r.onerror=()=>o(r.error)})}catch(e){return console.error("Error deleting cached file:",e),!1}}async function gs(){try{return new Promise((s,e)=>{const t=indexedDB.deleteDatabase(ke);t.onsuccess=()=>s(!0),t.onerror=()=>e(t.error)})}catch(s){return console.error("Error clearing cache:",s),!1}}function bs(s){const t=Date.now()-s,o=Math.floor(t/6e4),n=Math.floor(t/36e5),a=Math.floor(t/864e5);return o<1?"just now":o<60?`${o}m ago`:n<24?`${n}h ago`:`${a}d ago`}async function hs(s){return new Promise((e,t)=>{const o=new FileReader;o.onload=async n=>{try{const a=n.target.result,r=await $e(a,s.name);e(r)}catch(a){t(a)}},o.onerror=()=>t(new Error("Failed to read file")),o.readAsArrayBuffer(s)})}async function $e(s,e=""){try{let t=[];const o=e.toLowerCase();if(o.endsWith(".xls")){const i=Le(s,{type:"array"}),p=i.SheetNames[0],f=i.Sheets[p];t=ze.sheet_to_json(f,{header:1})}else{const i=new Oe.Workbook;o.endsWith(".csv")?s instanceof ArrayBuffer?await i.csv.read(new Blob([s])):await i.csv.read(s):await i.xlsx.load(s);const p=i.worksheets[0];if(!p)throw new Error("No worksheets found");p.eachRow({includeEmpty:!1},f=>{t.push(f.values.slice(1))})}let n=-1,a=null;for(let i=0;i<t.length;i++){const p=(t[i]||[]).join(" ").toLowerCase();if(p.includes("date")&&p.includes("user")){n=i,a=t[i];break}}if(n===-1){if(t.length===0)return[];n=0,a=t[0]}const r=[],c=a.map(i=>String(i).trim());for(let i=n+1;i<t.length;i++){const p=t[i],f={};let v=!1;c.forEach((d,g)=>{if(d){const k=p[g];f[d]=k,k!=null&&k!==""&&(v=!0)}}),v&&r.push(f)}return st(r)}catch(t){throw console.error("Parser Error",t),new Error(`Failed to parse data: ${t.message}`)}}function tt(s){return Array.isArray(s)?s.map((e,t)=>{const o=e.Date||e.date_spent||e.date||"",n=e.User||e.user||"Unknown",a=parseFloat(e.Units||e.hours||e.units)||0,r=e.Project||e.project||"Unassigned";let c="";if(o)if(/^\d{4}-\d{2}$/.test(o))c=o;else{const i=Me(o);i&&(c=`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}`)}return{id:t,date:c,user:String(n).trim(),units:a,project:String(r).trim(),rawDate:o}}).filter(e=>e.user&&e.project&&e.date&&e.units>0):[]}function V(s,e){const t=Object.keys(s);for(const o of e){const n=t.find(a=>a.trim().toLowerCase().includes(o));if(n)return n}return null}function st(s){if(!s||s.length===0)return[];const e=s[0],t=V(e,["date","spent"]),o=V(e,["user"]),n=V(e,["units","hours"]),a=V(e,["project"]);return(!t||!o||!n||!a)&&console.warn("Missing required columns. Found:",{dateKey:t,userKey:o,unitsKey:n,projectKey:a}),s.map((r,c)=>{const i=t?r[t]:"",p=o?r[o]||"Unknown User":"",f=n&&parseFloat(r[n])||0,v=a?r[a]||"Unassigned":"";let d="";if(i){const g=Me(i);g&&(d=`${g.getFullYear()}-${String(g.getMonth()+1).padStart(2,"0")}`)}return{id:c,date:d,user:String(p).trim(),units:isNaN(f)?0:f,project:String(v).trim(),rawDate:i}}).filter(r=>r.user&&r.project&&r.date&&r.units>0)}function Me(s){if(!s)return null;if(s instanceof Date)return s;if(typeof s=="number"){const o=new Date(Date.UTC(1899,11,30));return new Date(o.getTime()+s*864e5)}const e=String(s).trim();if(/^\d{4}-\d{2}-\d{2}/.test(e))return new Date(e);if(/^\d{1,2}\/\d{1,2}\/\d{4}/.test(e)){const[o,n,a]=e.split("/");return new Date(parseInt(a),parseInt(o)-1,parseInt(n))}if(/^\d{1,2}\/\d{1,2}\/\d{2,4}/.test(e)){const o=e.split("/");if(o[0]>12)return new Date(parseInt(o[2]),parseInt(o[1])-1,parseInt(o[0]))}const t=new Date(e);return isNaN(t.getTime())?null:t}function nt(s){const e=new Set;return s.forEach(t=>{t.date&&e.add(t.date)}),Array.from(e).sort()}function ms(s){const e=new Set;return s.forEach(t=>{t.project&&e.add(t.project)}),Array.from(e).sort()}function xs(s){const e=new Set;return s.forEach(t=>{t.user&&e.add(t.user)}),Array.from(e).sort()}const at={class:"absolute top-full left-0 mt-2 w-80 bg-slate-900 border border-slate-700 rounded-xl shadow-2xl z-50 overflow-hidden"},ot={class:"p-4 border-b border-slate-800"},rt={class:"text-[10px] text-slate-500 mt-1"},lt={class:"p-4 space-y-4"},it={class:"grid grid-cols-2 gap-3"},ut={class:"flex flex-col gap-1"},ct=["value"],dt={class:"flex flex-col gap-1"},pt=["value"],ft={__name:"DateFilter",props:["onClose"],emits:["close"],setup(s,{emit:e}){const t=e,o=b(null),n=b(null),a=b(null),r=b(null),c=b(j.value||""),i=b(R.value||""),p=nt(L.value),f=p.length>0?p[0]:null,v=p.length>0?p[p.length-1]:null;ie(()=>{const F=f?new Date(parseInt(f.split("-")[0]),parseInt(f.split("-")[1])-1,1):null,D=v?new Date(parseInt(v.split("-")[0]),parseInt(v.split("-")[1])-1,1):null,B=new Date,T=new Date(B.getFullYear(),B.getMonth(),1),h=D&&D>T?D:T,u={...be,dateFormat:"yyyy-MM"};if(o.value&&(a.value=new G(o.value,{locale:u,view:"months",minView:"months",container:"body",dateFormat:"yyyy-MM",autoClose:!0,position:"bottom center",classes:"dark-datepicker",minDate:F,maxDate:i.value?new Date(parseInt(i.value.split("-")[0]),parseInt(i.value.split("-")[1])-1,1):h,onSelect:({date:x})=>{if(x){const m=x.getFullYear(),C=String(x.getMonth()+1).padStart(2,"0"),$=`${m}-${C}`;c.value=$,r.value&&r.value.update({minDate:x})}else c.value="",r.value&&r.value.update({minDate:F})}}),c.value)){const[x,m]=c.value.split("-");a.value.selectDate(new Date(parseInt(x),parseInt(m)-1,1))}if(n.value&&(r.value=new G(n.value,{locale:u,view:"months",minView:"months",container:"body",dateFormat:"yyyy-MM",autoClose:!0,position:"bottom center",classes:"dark-datepicker",minDate:c.value?new Date(parseInt(c.value.split("-")[0]),parseInt(c.value.split("-")[1])-1,1):F,maxDate:h,onSelect:({date:x})=>{if(x){const m=x.getFullYear(),C=String(x.getMonth()+1).padStart(2,"0"),$=`${m}-${C}`;i.value=$,a.value&&a.value.update({maxDate:x})}else i.value="",a.value&&a.value.update({maxDate:h})}}),i.value)){const[x,m]=i.value.split("-");r.value.selectDate(new Date(parseInt(x),parseInt(m)-1,1))}}),ue(()=>{a.value&&a.value.destroy(),r.value&&r.value.destroy()});const d=()=>{K(c.value||null,i.value||null),t("close")},g=()=>{c.value="",i.value="",a.value&&a.value.clear(),r.value&&r.value.clear(),K(null,null),t("close")},k=()=>{if(f&&v){c.value=f,i.value=v;const[F,D]=f.split("-"),[B,T]=v.split("-");a.value&&a.value.selectDate(new Date(parseInt(F),parseInt(D)-1,1)),r.value&&r.value.selectDate(new Date(parseInt(B),parseInt(T)-1,1))}},M=()=>{t("close")};return(F,D)=>(y(),S("div",at,[l("div",ot,[D[0]||(D[0]=l("h3",{class:"text-sm font-bold text-slate-100 flex items-center gap-2"},[l("i",{class:"ph ph-calendar text-blue-400"}),P(" Date Range Filter ")],-1)),l("p",rt," Data spans: "+A(w(f)||"N/A")+" → "+A(w(v)||"N/A"),1)]),l("div",lt,[l("div",it,[l("div",ut,[D[1]||(D[1]=l("label",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},"From",-1)),l("input",{ref_key:"startPickerRef",ref:o,type:"text",placeholder:"Start Month",value:c.value,class:"w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 cursor-pointer",readonly:""},null,8,ct)]),l("div",dt,[D[2]||(D[2]=l("label",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},"To",-1)),l("input",{ref_key:"endPickerRef",ref:n,type:"text",placeholder:"End Month",value:i.value,class:"w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 cursor-pointer",readonly:""},null,8,pt)])]),l("div",{class:"flex gap-2"},[l("button",{onClick:k,class:"flex-1 px-3 py-2 text-xs text-slate-400 hover:text-slate-200 bg-slate-800 hover:bg-slate-700 rounded-lg border border-slate-700 transition-colors"}," Select All "),l("button",{onClick:g,class:"flex-1 px-3 py-2 text-xs text-slate-400 hover:text-slate-200 bg-slate-800 hover:bg-slate-700 rounded-lg border border-slate-700 transition-colors"}," Reset ")])]),l("div",{class:"p-4 bg-slate-800/50 border-t border-slate-800 flex justify-end gap-2"},[l("button",{onClick:M,class:"px-4 py-2 text-xs text-slate-400 hover:text-slate-200 transition-colors"}," Cancel "),l("button",{onClick:d,class:"px-4 py-2 text-xs font-bold text-white bg-blue-600 hover:bg-blue-500 rounded-lg transition-colors"}," Apply Filter ")])]))}},vt="modulepreload",gt=function(s,e){return new URL(s,e).href},ge={},ne=function(e,t,o){let n=Promise.resolve();if(t&&t.length>0){let p=function(f){return Promise.all(f.map(v=>Promise.resolve(v).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};const r=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),i=c?.nonce||c?.getAttribute("nonce");n=p(t.map(f=>{if(f=gt(f,o),f in ge)return;ge[f]=!0;const v=f.endsWith(".css"),d=v?'[rel="stylesheet"]':"";if(o)for(let k=r.length-1;k>=0;k--){const M=r[k];if(M.href===f&&(!v||M.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${f}"]${d}`))return;const g=document.createElement("link");if(g.rel=v?"stylesheet":vt,v||(g.as="script"),g.crossOrigin="",g.href=f,i&&g.setAttribute("nonce",i),document.head.appendChild(g),v)return new Promise((k,M)=>{g.addEventListener("load",k),g.addEventListener("error",()=>M(new Error(`Unable to preload CSS for ${f}`)))})}))}function a(r){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=r,window.dispatchEvent(c),!c.defaultPrevented)throw r}return n.then(r=>{for(const c of r||[])c.status==="rejected"&&a(c.reason);return e().catch(a)})},bt=s=>new Promise(e=>setTimeout(e,s)),ht=[{path:"/",redirect:"/upload"},{path:"/upload",name:"upload",component:()=>ne(()=>import("./UploadView-DVdhw0TC.js"),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url)},{path:"/dashboard",name:"dashboard-home",component:()=>ne(()=>import("./Dashboard-A8tBGXSC.js"),__vite__mapDeps([7,8,1,2,3,4,5,9,6]),import.meta.url),beforeEnter:async(s,e,t)=>{H.value?t():t("/upload")}},{path:"/dashboard/:filename",name:"dashboard-file",component:()=>ne(()=>import("./Dashboard-A8tBGXSC.js"),__vite__mapDeps([7,8,1,2,3,4,5,9,6]),import.meta.url),beforeEnter:async(s,e,t)=>{const o=s.params.filename;if(H.value){t();return}if(o)try{U(!0,"Restoring session..."),await bt(50);const a=await Ze(o==="supabase"?"SUPABASE_CACHE":o);if(a&&a.data)if(a.isSupabase||o==="SUPABASE_CACHE"||o==="supabase"){let r=a.data;typeof r=="string"&&(r=JSON.parse(r));const c=tt(r);if(c.length>0){oe(c,"Supabase Connection"),J.value="supabase";const i=ce();i&&i.url&&i.key&&(Z(i.url,i.key),i.startDate&&i.endDate&&K(i.startDate,i.endDate)),t()}else t("/upload")}else{const r=await $e(a.data,o);r.length>0?(oe(r,o),J.value="file",t()):t("/upload")}else console.warn(`File ${o} not found in cache`),t("/upload")}catch(n){console.error("Error restoring session:",n),t("/upload")}finally{U(!1)}else t("/upload")}}],X=Fe({history:Pe(),routes:ht});function le(){X.push("/upload")}function mt(s){s?X.push(`/dashboard/${encodeURIComponent(s)}`):X.push("/dashboard")}const xt={class:"bg-slate-900 border-b border-slate-800 px-6 py-2 flex justify-between items-center shadow-sm shrink-0 z-40 relative"},yt={class:"flex items-center -space-x-px"},wt={key:0,class:"relative"},St={class:"hidden md:flex flex-col items-start leading-none gap-0.5"},Dt={class:"text-[10px] font-medium"},_t=["title"],kt={class:"hidden md:inline text-xs font-medium"},Ct={class:"relative"},Et={class:"p-2 flex flex-col gap-1"},$t={key:0,class:"flex items-center gap-2 px-3 py-2 mb-1 rounded-lg bg-blue-500/10 border border-blue-500/20"},Mt={__name:"Header",setup(s){const e=b(!1),t=Q(()=>{if(!j.value&&!R.value)return"Showing everything";const v=j.value||"Beginning",d=R.value||"Present";return`${v} → ${d}`}),o=()=>{e.value=!1},n=v=>{v.stopPropagation(),z()},a=async()=>{z();try{await _e(ye.value,we.value,j.value,R.value)}catch(v){alert("Sync failed: "+v.message)}},r=async()=>{confirm("Are you sure you want to disconnect Supabase?")&&(Je(),await et("SUPABASE_CACHE"),Z(null,null),re(),z(),le())},c=()=>{re(),le()},i=b(null),p=b(null),f=v=>{Y.value&&i.value&&!i.value.contains(v.target)&&p.value&&!p.value.contains(v.target)&&z()};return ie(()=>{document.addEventListener("click",f)}),ue(()=>{document.removeEventListener("click",f)}),(v,d)=>(y(),S("header",xt,[d[12]||(d[12]=Ie('<div class="flex items-center gap-3 md:gap-4"><i class="ph ph-calendar-check text-3xl text-blue-500 shrink-0"></i><div class="hidden md:block"><h1 class="font-bold text-base leading-tight text-slate-100">Monthly Project Report</h1><p class="text-[10px] text-slate-400">Project Trends &amp; Developer Breakdown</p></div></div>',1)),l("div",yt,[w(H)?(y(),S("div",wt,[l("button",{onClick:d[0]||(d[0]=g=>e.value=!e.value),class:I(["flex items-center gap-2 px-3 md:px-4 h-[38px] bg-slate-800 border border-slate-700 rounded-l-xl hover:bg-slate-700 transition-all z-10 relative focus:z-20 hover:text-blue-400",e.value?"text-blue-400 bg-slate-700":"text-slate-300"]),title:"Date Range"},[d[4]||(d[4]=l("i",{class:"ph ph-calendar text-lg"},null,-1)),l("div",St,[d[3]||(d[3]=l("span",{class:"text-[9px] uppercase font-bold text-slate-500 group-hover:text-blue-400/70 transition-colors"},"Range",-1)),l("span",Dt,A(t.value),1)])],2),e.value?(y(),ae(ft,{key:0,onClose:o,class:"!left-auto !right-0 origin-top-right"})):E("",!0)])):E("",!0),w(H)?(y(),S("button",{key:1,onClick:d[1]||(d[1]=(...g)=>w(fe)&&w(fe)(...g)),class:I(["flex items-center gap-2 px-3 md:px-4 h-[38px] bg-slate-800 border border-slate-700 hover:bg-slate-700 transition-all z-0 relative focus:z-20 border-l-0",w(O)?"text-blue-400":"text-slate-400"]),title:w(O)?"Hide Graph":"Show Graph"},[l("i",{class:I(["ph text-lg",w(O)?"ph-eye":"ph-eye-slash"])},null,2),l("span",kt,A(w(O)?"Hide":"Show")+" Graph",1)],10,_t)):E("",!0),l("button",{onClick:c,class:I(["flex items-center gap-2 px-3 md:px-4 h-[38px] bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-blue-400 text-xs font-bold transition-all border border-slate-700 border-l-0 relative focus:z-20",{"rounded-l-xl":!w(H)}])},[...d[5]||(d[5]=[l("i",{class:"ph ph-file-plus text-lg"},null,-1),l("span",{class:"hidden md:inline"},"New File",-1)])],2),l("div",Ct,[l("button",{ref_key:"settingsBtnRef",ref:p,onClick:n,class:I(["flex items-center justify-center px-3 h-[38px] bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-blue-400 text-xs font-bold rounded-r-xl transition-all border border-slate-700 border-l-0 relative focus:z-20",w(Y)?"bg-slate-700 text-blue-400":""]),title:"Configuration"},[...d[6]||(d[6]=[l("i",{class:"ph ph-dots-three text-xl"},null,-1)])],2),w(Y)?(y(),S("div",{key:0,ref_key:"settingsMenuRef",ref:i,class:"absolute right-0 mt-2 w-56 bg-slate-900 border border-slate-700 rounded-xl shadow-2xl overflow-hidden z-50"},[l("div",Et,[w(W)?(y(),S("div",$t,[...d[7]||(d[7]=[l("div",{class:"w-1.5 h-1.5 rounded-full bg-blue-400 animate-pulse"},null,-1),l("span",{class:"text-[10px] font-bold text-blue-400 uppercase tracking-wider"},"Supabase Connected",-1)])])):E("",!0),d[11]||(d[11]=l("h4",{class:"px-3 py-1.5 text-[10px] font-bold text-slate-500 uppercase tracking-widest"},"Data Source",-1)),l("button",{onClick:d[2]||(d[2]=g=>{w(Ye)(),w(z)()}),class:"flex items-center gap-3 px-3 py-2 text-xs text-slate-300 hover:bg-slate-800 rounded-lg transition-colors group"},[d[8]||(d[8]=l("i",{class:"ph ph-database text-blue-400 group-hover:scale-110 transition-transform"},null,-1)),l("span",null,A(w(W)?"Configure Supabase":"Connect Supabase"),1)]),w(W)?(y(),S(N,{key:1},[l("button",{onClick:a,class:"flex items-center gap-3 px-3 py-2 text-xs text-blue-400 hover:bg-blue-500/10 rounded-lg transition-colors group"},[...d[9]||(d[9]=[l("i",{class:"ph ph-arrows-clockwise group-hover:animate-spin"},null,-1),l("span",null,"Sync Now",-1)])]),l("button",{onClick:r,class:"flex items-center gap-3 px-3 py-2 text-xs text-red-400 hover:bg-red-500/10 rounded-lg transition-colors group"},[...d[10]||(d[10]=[l("i",{class:"ph ph-plugs-off group-hover:scale-110 transition-transform"},null,-1),l("span",null,"Disconnect Supabase",-1)])])],64)):E("",!0)])],512)):E("",!0)])])]))}},At={class:"fixed inset-0 z-[200] flex items-center justify-center bg-slate-950/50 backdrop-blur-[2px]"},Ft={class:"bg-slate-900 border border-slate-700 rounded-2xl p-6 shadow-2xl flex flex-col items-center gap-4"},Pt={class:"text-sm font-medium text-slate-200"},It={__name:"LoadingOverlay",props:{text:{type:String,default:"Processing..."}},setup(s){return(e,t)=>(y(),S("div",At,[l("div",Ft,[t[0]||(t[0]=l("div",{class:"w-12 h-12 border-4 border-blue-500/20 border-t-blue-500 rounded-full animate-spin"},null,-1)),l("p",Pt,A(s.text),1)])]))}},jt={key:0,class:"fixed inset-0 z-[100] flex items-center justify-center p-4"},Rt={class:"bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-hidden flex flex-col"},Nt={class:"p-6 space-y-5 overflow-y-auto flex-1 custom-scrollbar"},Ut={class:"space-y-2"},Bt=["value"],Tt={class:"space-y-2"},Ot=["value"],Lt=["disabled"],zt={key:0,class:"bg-red-500/10 border border-red-500/20 rounded-xl p-3"},Yt={class:"text-[10px] text-red-300 leading-relaxed"},qt={key:1,class:"space-y-5 animate-in fade-in slide-in-from-top-2 duration-300"},Ht={class:"grid grid-cols-2 gap-3"},Kt={class:"space-y-2"},Vt=["value"],Wt={class:"space-y-2"},Gt=["value"],Jt={class:"flex items-center justify-between px-1"},Xt={key:0,class:"bg-amber-500/10 border border-amber-500/20 rounded-xl p-4"},Qt={class:"flex gap-3"},Zt={class:"text-[10px] text-amber-200 leading-relaxed italic"},es={class:"p-6 bg-slate-800/50 border-t border-slate-800 flex flex-col gap-3 shrink-0"},ts=["disabled"],ss={__name:"SupabaseModal",setup(s){const e=b(""),t=b(""),o=b(!1),n=b(!1),a=b(0),r=b(""),c=b(!1),i=b(null),p=b(null),f=b(null),v=b(null),d=b(""),g=b("");te(()=>q.value,h=>{if(h){const u=ce();if(u)e.value=u.url||"",t.value=u.key||"",d.value=u.startDate||"",g.value=u.endDate||"";else{const x=new Date,m=new Date(x.getFullYear(),x.getMonth()-2,1),C=new Date(x.getFullYear(),x.getMonth(),1),$=de=>`${de.getFullYear()}-${String(de.getMonth()+1).padStart(2,"0")}`;d.value=$(m),g.value=$(C)}}}),te(n,h=>{h&&q.value&&setTimeout(k,50)});function k(){const h=new Date,u=new Date(h.getFullYear(),h.getMonth(),1),x={...be,dateFormat:"yyyy-MM"};if(i.value&&!f.value&&(f.value=new G(i.value,{locale:x,view:"months",minView:"months",container:"body",dateFormat:"yyyy-MM",autoClose:!0,position:"bottom center",classes:"dark-datepicker",maxDate:g.value?new Date(parseInt(g.value.split("-")[0]),parseInt(g.value.split("-")[1])-1,1):u,onSelect:({date:m})=>{if(m){const C=m.getFullYear(),$=String(m.getMonth()+1).padStart(2,"0");d.value=`${C}-${$}`,v.value&&v.value.update({minDate:m})}}}),d.value)){const[m,C]=d.value.split("-");f.value.selectDate(new Date(parseInt(m),parseInt(C)-1,1))}if(p.value&&!v.value&&(v.value=new G(p.value,{locale:x,view:"months",minView:"months",container:"body",dateFormat:"yyyy-MM",autoClose:!0,position:"bottom center",classes:"dark-datepicker",minDate:d.value?new Date(parseInt(d.value.split("-")[0]),parseInt(d.value.split("-")[1])-1,1):null,maxDate:u,onSelect:({date:m})=>{if(m){const C=m.getFullYear(),$=String(m.getMonth()+1).padStart(2,"0");g.value=`${C}-${$}`,f.value&&f.value.update({maxDate:m})}}}),g.value)){const[m,C]=g.value.split("-");v.value.selectDate(new Date(parseInt(m),parseInt(C)-1,1))}}ue(()=>{f.value&&f.value.destroy(),v.value&&v.value.destroy()}),te([d,g],([h,u])=>{n.value&&e.value&&t.value&&h&&u&&M(!0)});const M=async(h=!1)=>{if(!(!e.value||!t.value)){h||(o.value=!0,r.value=""),r.value="";try{const u=await He(e.value,t.value,d.value,g.value);a.value=u,n.value=!0}catch(u){console.error("Supabase connection error:",u),r.value=u.message||"Failed to connect to Supabase",n.value=!1}finally{h||(o.value=!1)}}},F=async()=>{if(n.value){c.value=!0;try{Ge(e.value,t.value,d.value,g.value),Z(e.value,t.value),K(d.value,g.value),await _e(e.value,t.value,d.value,g.value),pe(),mt("supabase")}catch(h){console.error("Supabase sync error:",h),alert("Failed to sync data: "+h.message)}finally{c.value=!1}}},D=()=>{pe()},B=h=>{e.value=h.target.value,n.value=!1,r.value=""},T=h=>{t.value=h.target.value,n.value=!1,r.value=""};return(h,u)=>w(q)?(y(),S("div",jt,[l("div",{class:"absolute inset-0 bg-slate-950/80 backdrop-blur-sm -z-10",onClick:D}),l("div",Rt,[l("div",{class:"p-6 border-b border-slate-800 flex justify-between items-center bg-slate-900/50 shrink-0"},[u[2]||(u[2]=l("h3",{class:"text-lg font-bold text-slate-100 flex items-center gap-2"},[l("i",{class:"ph ph-database text-blue-400"}),P(" Connect Supabase ")],-1)),l("button",{onClick:D,class:"text-slate-500 hover:text-slate-300"},[...u[1]||(u[1]=[l("i",{class:"ph ph-x text-xl"},null,-1)])])]),l("div",Nt,[l("div",Ut,[u[3]||(u[3]=l("label",{class:"text-xs font-bold text-slate-400 uppercase tracking-widest"},"Base URL",-1)),l("input",{type:"text",placeholder:"https://xyz.supabase.co",value:e.value,onInput:B,class:"w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all"},null,40,Bt)]),l("div",Tt,[u[4]||(u[4]=l("label",{class:"text-xs font-bold text-slate-400 uppercase tracking-widest"},"Anon / Public Key",-1)),l("input",{type:"password",placeholder:"ey4M3r57gPmdpGsstMcFB4UPh...",value:t.value,onInput:T,class:"w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all"},null,40,Ot)]),l("button",{onClick:u[0]||(u[0]=x=>M(!1)),disabled:!e.value||!t.value||o.value,class:I(["w-full py-2.5 font-bold rounded-xl border transition-all active:scale-95 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",n.value?"bg-green-500/20 text-green-400 border-green-500/30":r.value?"bg-red-500/10 text-red-400 border-red-500/20":"bg-slate-800 hover:bg-slate-700 text-blue-400 border-slate-700"])},[o.value?(y(),S(N,{key:0},[u[5]||(u[5]=l("div",{class:"w-4 h-4 border-2 border-current opacity-20 border-t-current rounded-full animate-spin"},null,-1)),u[6]||(u[6]=P(" Connecting... ",-1))],64)):n.value?(y(),S(N,{key:1},[u[7]||(u[7]=l("i",{class:"ph ph-check-circle"},null,-1)),u[8]||(u[8]=P(" Connected ",-1))],64)):r.value?(y(),S(N,{key:2},[u[9]||(u[9]=l("i",{class:"ph ph-warning-circle"},null,-1)),u[10]||(u[10]=P(" Connection Failed ",-1))],64)):(y(),S(N,{key:3},[u[11]||(u[11]=l("i",{class:"ph ph-plugs"},null,-1)),u[12]||(u[12]=P(" Connect ",-1))],64))],10,Lt),r.value?(y(),S("div",zt,[l("p",Yt,A(r.value),1)])):E("",!0),n.value?(y(),S("div",qt,[l("div",Ht,[l("div",Kt,[u[13]||(u[13]=l("label",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},"From Month",-1)),l("input",{ref_key:"startPickerRef",ref:i,type:"text",readonly:"",value:d.value,class:"w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-sm text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 cursor-pointer"},null,8,Vt)]),l("div",Wt,[u[14]||(u[14]=l("label",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},"To Month",-1)),l("input",{ref_key:"endPickerRef",ref:p,type:"text",readonly:"",value:g.value,class:"w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-sm text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 cursor-pointer"},null,8,Gt)])]),l("div",Jt,[l("span",{class:I(["text-[10px] font-medium",a.value>=1e3?"text-red-400":"text-green-400"])},"Data found in range:",2),l("span",{class:I(["text-[10px] font-bold",a.value>=1e3?"text-red-400":"text-green-400"])},A(a.value.toLocaleString())+" rows",3)]),a.value>=1e3?(y(),S("div",Xt,[l("div",Qt,[u[15]||(u[15]=l("i",{class:"ph ph-warning-circle text-amber-400 text-lg shrink-0"},null,-1)),l("p",Zt," Warning: Found "+A(a.value.toLocaleString())+" rows. Only 1,000 rows will be fetched. Consider narrowing your date range. ",1)])])):E("",!0)])):E("",!0),u[16]||(u[16]=l("div",{class:"bg-blue-500/5 border border-blue-500/10 rounded-xl p-4"},[l("p",{class:"text-[10px] text-blue-300 leading-relaxed italic"}," Credentials are stored only in your browser. Data is fetched directly from Supabase via REST API. Max 1,000 rows per sync. ")],-1))]),l("div",es,[l("button",{onClick:F,disabled:!n.value||c.value,class:"w-full py-3 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-xl shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2 disabled:opacity-50 disabled:grayscale disabled:cursor-not-allowed"},[c.value?(y(),S(N,{key:0},[u[17]||(u[17]=l("div",{class:"w-4 h-4 border-2 border-white/20 border-t-white rounded-full animate-spin"},null,-1)),u[18]||(u[18]=P(" Syncing... ",-1))],64)):(y(),S(N,{key:1},[u[19]||(u[19]=l("i",{class:"ph ph-check-circle text-lg"},null,-1)),u[20]||(u[20]=P(" Save & Sync Data ",-1))],64))],8,ts)])])])):E("",!0)}},ns={class:"h-screen w-full bg-slate-950 text-slate-200 font-sans flex flex-col overflow-hidden"},as={class:"flex-1 overflow-hidden relative"},os={__name:"App",setup(s){Ne(),Ue();const e=()=>{re(),le()};return ie(()=>{const t=ce();t&&t.url&&t.key&&(Z(t.url,t.key),t.startDate&&t.endDate&&K(t.startDate,t.endDate))}),(t,o)=>{const n=Re("router-view");return y(),S("div",ns,[w(me)?(y(),ae(It,{key:0,text:w(xe)},null,8,["text"])):E("",!0),se(ss),se(Mt,{onReset:e}),l("div",as,[se(n,null,{default:je(({Component:a})=>[(y(),ae(Be(a)))]),_:1})])])}}},Ae=Te(os);Ae.use(X);Ae.mount("#app");export{fs as a,mt as b,gs as c,bs as d,ms as e,ds as f,vs as g,nt as h,xs as i,ps as j,he as k,Ze as l,O as m,tt as n,hs as p,L as r};
