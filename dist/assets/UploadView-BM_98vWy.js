import{g as S,c as _,p as j,a as f,b as m,d as R,l as T,n as A}from"./index-DhrgWT4q.js";import{o as N,b as o,d as r,e,n as h,f as b,F as U,A as z,r as d,t as u,u as B}from"./vendor-CnOKNHKp.js";import"./vendor-exceljs-B3-f5COA.js";import"./vendor-xlsx-BrcMyRkh.js";import"./vendor-datepicker-ChPokmFs.js";/* empty css                        */const E={class:"w-full h-full overflow-y-auto flex items-start justify-center transition-all duration-500 ease-in-out"},P={class:"w-full max-w-xl mt-20 p-6"},L={key:0,class:"mt-8"},V={class:"space-y-2"},I=["onClick"],O={class:"flex items-center gap-3 flex-1 min-w-0"},H={class:"flex-1 min-w-0"},Z={class:"font-medium truncate"},$={class:"text-xs text-slate-500 mt-0.5"},G={key:1,class:"mt-8"},X={__name:"UploadView",setup(J){const x=d(null),g=d(null),n=d([]),i=d(!1),c=async()=>{n.value=await S()};N(()=>{c()});const p=async(s,t=null)=>{if(s)try{const a=await j(s);if(a.length===0){alert("No valid data found in the file. Please check the file format.");return}if(t)await f(s,t,a.length);else{const l=await s.arrayBuffer();await f(s,l,a.length)}m(s.name),await c()}catch(a){console.error("File processing error:",a),alert("Failed to process file: "+a.message)}},v=async s=>{try{const t=await T(s);if(t&&t.data)if(t.isSupabase||s==="SUPABASE_CACHE"){let a=t.data;typeof a=="string"&&(a=JSON.parse(a)),A(a).length>0?m("supabase"):(alert("No valid data found in cached Supabase data."),c())}else{const a=new Blob([t.data]),l=new File([a],s);await p(l,t.data)}else alert("Cached file has expired or is no longer available."),c()}catch(t){console.error("Error loading cached file:",t),alert("Failed to load cached file: "+t.message)}},w=async()=>{confirm("Clear all cached files? This cannot be undone.")&&(await _(),n.value=[])},y=s=>{s.preventDefault(),i.value=!0},C=s=>{s.preventDefault(),i.value=!1},k=s=>{s.preventDefault(),i.value=!1,s.dataTransfer.files&&s.dataTransfer.files.length>0&&p(s.dataTransfer.files[0])},D=s=>{s.target.files&&s.target.files.length>0&&p(s.target.files[0])},F=()=>{x.value.click()};return(s,t)=>(o(),r("div",E,[e("div",P,[t[7]||(t[7]=e("div",{class:"text-center mb-8"},[e("h2",{class:"text-2xl font-bold text-slate-100 mb-2"},"Upload Cost Report"),e("p",{class:"text-slate-400"},"Drag and drop your .xls, .xlsx or .csv file to see monthly trends.")],-1)),e("div",{ref_key:"dropZoneRef",ref:g,onClick:F,onDragover:y,onDragleave:C,onDrop:k,class:h(["bg-slate-900 border-2 border-dashed border-slate-700 rounded-2xl p-12 text-center transition-all cursor-pointer group",i.value?"border-blue-500 bg-slate-800 scale-[1.02]":"hover:border-blue-500 hover:bg-slate-800 hover:shadow-xl"])},[e("input",{ref_key:"fileInputRef",ref:x,type:"file",class:"hidden",accept:".csv, .xls, .xlsx, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",onChange:D},null,544),t[0]||(t[0]=e("div",{class:"w-20 h-20 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-300 border border-slate-700"},[e("i",{class:"ph ph-calendar-plus text-4xl text-blue-400"})],-1)),t[1]||(t[1]=e("p",{class:"text-lg font-semibold text-slate-200 mb-1"},"Click or Drag File",-1)),t[2]||(t[2]=e("p",{class:"text-sm text-slate-500"},"Supports Excel (.xls, .xlsx) & CSV",-1))],34),t[8]||(t[8]=e("div",{class:"mt-4 text-center"},[e("a",{href:"/assets/sample-template.csv",download:"openproject-sample-template.csv",class:"inline-flex items-center gap-2 text-sm text-blue-400 hover:text-blue-300 transition-colors"},[e("i",{class:"ph ph-download-simple"}),e("span",null,"Download Sample Template")]),e("p",{class:"text-xs text-slate-500 mt-1"},"Your file must match this format: Date, User, Units, Project")],-1)),n.value.length>0?(o(),r("div",L,[e("div",{class:"flex items-center justify-center gap-3 mb-3"},[t[4]||(t[4]=e("h3",{class:"text-sm font-semibold text-slate-300 flex items-center gap-2"},[e("i",{class:"ph ph-clock-counter-clockwise text-blue-400"}),b(" Recently Processed ")],-1)),e("button",{onClick:w,class:"text-red-400 hover:text-red-300 transition-colors flex items-center gap-1",title:"Clear cache"},[...t[3]||(t[3]=[e("i",{class:"ph ph-trash text-sm"},null,-1)])])]),e("div",V,[(o(!0),r(U,null,z(n.value,a=>(o(),r("button",{key:a.name,onClick:l=>v(a.name),class:"w-full text-left text-sm text-slate-300 hover:text-blue-400 hover:bg-slate-800 px-4 py-2.5 rounded-lg border border-slate-700 hover:border-blue-500 transition-all flex items-center justify-between group"},[e("div",O,[e("i",{class:h([a.isSupabase?"ph ph-database text-blue-400":"ph ph-file-xls text-green-400","text-lg flex-shrink-0"])},null,2),e("div",H,[e("div",Z,u(a.isSupabase?"Supabase Live Connection":a.name),1),e("div",$,u(a.rowCount?`${a.rowCount} rows`:"Unknown rows")+" â€¢ "+u(B(R)(a.timestamp)),1)])]),t[5]||(t[5]=e("i",{class:"ph ph-arrow-right text-slate-500 group-hover:text-blue-400 transition-colors flex-shrink-0"},null,-1))],8,I))),128))])])):(o(),r("div",G,[...t[6]||(t[6]=[e("h3",{class:"text-sm font-semibold text-slate-400 mb-4 flex items-center gap-2 justify-center"},[e("i",{class:"ph ph-clock-counter-clockwise text-blue-400"}),b(" Recently Processed ")],-1),e("p",{class:"text-xs text-slate-600 text-center py-4"},"No recent files",-1)])])),t[9]||(t[9]=e("div",{class:"mt-12 text-center pb-6"},[e("a",{href:"https://github.com/darkcolonist/openproject-export-monthly-visualizer",target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center gap-2 text-xs text-slate-500 hover:text-blue-400 transition-colors"},[e("i",{class:"ph ph-github-logo text-base"}),e("span",null,"Open Source on GitHub")])],-1))])]))}};export{X as default};
